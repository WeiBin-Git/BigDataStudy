
#### 数据仓库

* 如何搭建一个数仓
* 如何理解数据治理
  * 确保可用的数据帮助企业产生价值
  * 用数据的时候就像超市的货架一样用起来很方便
  * 数据现状：数据获取难，数据质量差，数据适用难
  * 包括元数据治理，数据标准治理，数据质量治理，数据安全治理，数据生命周期治理



##### 数仓介绍
* 面向主题，集成的，相对稳定的，反应历史变化的数据集合，用于支持管理决策
* 将源系统数据抽取、清洗、规格化、提交到维度数据存储的系统，为决策的指定提供查询和分析功能
* 设计原则
  * 底层业务的数据驱动为导向，同时结合业务需求驱动；
  * 便于数据分析，屏蔽底层复杂业务
  * 底层业务变动与上层需求变动对模型冲击最小化
  * 高内聚，松耦合
  * 
##### 数仓痛点
* 第一阶段：使用大量成熟框架，外围系统自研能力较弱；一般以离线批处理为主
* 第二阶段：开源+自研，有自己方法论和建模体系，有比较完善的元数据管理，数据质量监控，能有效支持离线实时
* 第三阶段：有自研通用式的处理凭条，有完善的数仓理论和外围工具，有完善的数据共享机制和权限管理
* 痛点
  * 临时取数需求占用数仓人员大部分时间
  * 数据规范和流程不一致，跨部门合作困难
  * 指标口径不一致导致数据可信度下降
  * 烟囱式开发形成数据孤岛和重复计算
  * 数据膨胀导致计算资源紧张
  * 异常排查和修复时间长
  * 数据安全和数据共享矛盾不可调和
  * 产出形式单一
  * 业务需求响应不及时
* 解决办法
  * 自助取数+OLAP系统
  * 元数据与数据质量监控，血缘管理
  * 数据分级与权限管理
  * 数据产品和服务化
  * 建模规范+开发规范
  * 指标字典
##### 数仓模型
* 数仓分层
    * 接入层(ODS)-->中间层(DW:DWD,DWS,DWM,DIM,TMP)-->应用层(APP)
    * DWD: 明细层，对接入的数据进行清洗和转换以及维度的补充；
    * DWS：汇总层，单业务场景
    * DWM: 集市层，多业务场景，有主题域
    * DIM: 基于明细数据抽象出公共维度，包括城市信息，渠道信息，个人基础属性信息
* 数据边界
  * ODS：数据同步，基本保持与源数据格式一致，不过多校验; 因为上层可能回溯，所以保存原始数据
  * DIM: 一致性维度建设；
  * DWD: 标准化，维度补全，异常处理
  * DWS: 单业务场景，行为数据组装（轻维度汇总），提升公共指标复用
  * DWM: 宽表集市、跨业务场景、行为数据组装
  * APP: 个性化指标加工，基于应用的数据组装
* 流向原则：禁止逆向调用；避免同层调用；优先使用公共层；避免跨层调用
##### 数仓规范
* 表命名规范：仓库分层-业务域-数据域-业务描述-时间周期+存储策略
* 字段命名规范：
* 需求对接规范：
* 数据开发规范：指定库和队列；表创建；分区加载；UDF；数据写入；临时表清除；
##### 外围系统建设
* 调度系统：ariflow，阿兹卡班，ozzie
* 元数据管理系统
  * 表信息、字段信息、负责人信息、分区信息、血缘信息、代码信息、存储信息、热度信息、权限信息、使用注意事项
* 通用离线和实时平台
* 数据质量监控（DQC）
  * 表级别监控：条数，大小，分区数据，分区大小，同环比，日增长情况
  * 字段级别：枚举值异常，特殊值判断，范围判断
  * 全链路数据监控：依赖于上下游血缘分析，自动判断跟踪故障点
##### 发展方向展望
* 数据产品化
  * 面向管理层的宏观经营分析系统
  * 面向运营人员的业务监控报表系统
  * 面向广告和营销的一体化数据营销平台
* 数据服务化
  * 数据以接口方式直接服务于线上业务
  * 数据以共享平台方式提供基础标签服务
##### 数仓架构
* lambda架构
* kappa架构
##### OLAP 和 OLTP
* 联机事务处理系统    联机分析处理系统
* OLAP：原子性，一致性，孤立性，持续性
* OLTP：维度，度量，下钻与上卷，切片与切块，旋转
* 基本含义不同；实时性要求不同；数据量不同；用户和系统面向性不同，数据库设计不同；
##### 模型设计
* 三个阶段
  * 概念模型：将业务划分为几个主题，并确定主题之间的关系；
  * 逻辑模型：范式建模和维度建模
  * 物理模型
* 范式建模和维度建模
  * 范式建模
    * 三范式：（1）每个属性值唯一（2）每个非主属性必须完全依赖于整个主键（3）每个非主属性不能依赖于其他关系中的属性；
    * 优点：节约存储；结构清晰；易于理解；适合关系型数据库；
    * 缺点：构建比较繁琐；查询复杂；不适合构建在大数据分布式环境；
  * 维度建模
    * 数据可以抽象成事实和维度，维度为观察事物的角度，事实对应某粒度下的度量值；
    * 1、选择业务过程
    * 2、声明粒度
    * 3、确认维度
    * 4、确认事实
    * 优点：方便使用；适合大数据下的数据处理；适合进行OLAP操作
    * 缺点：造成数据存储浪费；维度变化造成的数据量更新大；典型的反三范式；
* 事实表
   * 度量：可加，半可加，不可加
   * 一致性： 表内部一致性，表与表之间一致性
   * 事务事实表：一行代表空间过时间上某点的度量时间
   * 周期快照事实表：每行汇总了发生在某一周期的多个度量事件；
   * 累积快照事实表：汇总了发生在过程开始和结束之间可预测步骤的度量事件；
   * 无事实的事实表：分析了发生了什么
   * 聚焦事实表和OLAP多维数据库
   * 合并事实表
* 维度表
   * 包含单一的主键列


##### 数据指标体系建设
* 数据调研：
  * 业务调研：运营部和需求方
  * 技术调研：通过手段，保证成本的前提下，支持所进行的业务调研
* 明确统计指标：
  * 原子指标：订单量，用户量，pu，pv等
  * 衍生和派生指标：原子指标上进行加减乘除，网站近一周的访问量
* 明确统计口径
  * 明确业务过程
  * 明确统计维度
* 明细模型设计
  * 构建一致性事实表和维度表
* 汇总模型设计
* 代码开发
* 部署运营

* 什么是指标
  * 指标是指将业务单元细分后量化的度量值，它使得业务目标可描述、可度量、可拆解，它是业务和数据的结合，是统计的基础，也是量化效果的重要依据。
  * 分为结果型指标和过程型指标
  * 定义---生产---消费---下线
  * 指标分级法
    * 根据企业战略目标，组织及业务过程自上而下进行分级；（公司战略层面，业务策略层面，业务执行层面）
  * OSM模型
    * 用户使用产品的目标是什么
    * 为了达成目标采取的策略
    * 策略带来的数据指标变化
    * 
* 管理目标
  * 统一指标和维度管理，指标命名、计算口径、统计来源唯一，  维度定义规范、维度值一致
  * 统一数据出口、场景化覆盖
  * 指标体系管理工具产品化落地；指标体系内容产品化落地支持决策、分析、运营例如决策北极星、智能运营分析产品等
  * 