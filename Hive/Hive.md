#### Hive
* Hive版本  1.1.0
* Hive架构
  * 客户端：分为driver jdbc  编译器 解析器 优化器 执行器
  * 元数据：meta存到mysql中，因为mysql支持多用户访问
  * 执行引擎：MR  SPARK  TEZ：在内存运行，将多个mr转换为一个mr最终写hdfs一次；
  * 存储：HDFS
* Hive sql性能优化（平台层面，执行层面，参数层面）
  * mapjoin：现在默认开启，只要满足条件就会开启
  * 用到哪个列就取哪个列
  * 分区分桶，用到哪个区就取哪个区
  * 合理设置map数量：map数越多，JVM开关品管，越少处理慢
  * 合理设置reduce数量：涉及到小文件问题，越多输出小文件越多
  * JVM重用
  * 对于小文件，开启map端局部聚合；combinerfileinputformat
  * 压缩：中间结果集压缩等
* SQL 怎么转换为MR：
  * 定义SQL语法规则，完成sql解析，转换成抽象语法树
  * 遍历语法树，抽象出查询的基本组成单元queryblock
  * 遍历queryblock，翻译为执行操作树
  * 逻辑层优化器进行操作树转换，合并不必要的操作，减少shuffle数量
  * 遍历操作树，翻译为mapreduce任务
  * 物理层优化器进行mr任务转换，生成最终的执行计划
* UDF函数 和 UDTF函数
  *  灵活实现业务需求；设置日志埋点方便debug
  *  继承udf，重写evaluate方法
  *  继承genericUDTF，重写三个方法
* Hive 窗口函数
* 动态行转动态列
* hive sql去重
  * distinct：速度慢
  * group by：速度快
* 数据倾斜
  * mapjoin
  * 给key增加随机数，分发到reduce，在reduce中去掉随机数
  * 自定义分区策略
  * 核心思想是把key打散，使得分布均匀
* Hive 负载均衡
* Hive 左连接和内连接的区别
* 监控Hive提交状态：
* on 和Where区别：on先执行，where后执行，having最后执行
* Hive存储格式：默认存储textfile，orc（压缩比比较高），parquet（二进制存储，面向分析性存储）
* 压缩：原始数据选择LZO压缩，DWD层使用parquet
* Hive分区及其优势：
* 拉链表
  * 记录历史，记录一个事务从开始，一直到当前状态的所有变化信息；
  * 主要解决数据缓慢变换维度的问题
  * 优点：相比每次全量同步，可以节省空间，能够查到历史快照
  * 缺点：同步逻辑负责，消耗资源多
  * 制作拉链表：在原始表中增加字段，一个开始时间，一个结束时间
  * 然后丛mysql中导入的数据都是新增及变化
  * 让原始拉链表去join变化表，关联条件写上，过滤出结束时间极限值的，关联上则修改结束时间为昨天日期，关联不上还是之前的日期，然后插入到拉链表中
  * 临时拉链表和原始拉链表字段一致
  * 然后再将临时拉链表中的数据覆盖到原始拉链表中
* Hive 存储文件格式
  * textFile
    * 每一行都是一条记录，每行都以换行符结尾
    * 数据不做压缩，磁盘开销大，数据解析开销大
  * sequenceFile
    * 二进制文件支持，使用方便，可切割，可压缩
  * orcfile
    * 行列式存储
  * parquet
    * 压缩比第，查询效率低，不支持update操作，但是支持impala引擎
    *
* 优缺点
  * 缺点：表达能力有限：迭代算法无法实现，实现不了数据挖掘算法，
  * 效率比较低：自动生成MR作业，不够智能化；调优比较困难，粒度比较粗；
  * 优点：学习成本低，可以分析大量数据，可以自定义函数；